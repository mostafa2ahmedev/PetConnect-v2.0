<section id="hero" class="hero section pb-5">
  <div
    class="container section-title aos-init aos-animate pb-0"
    data-aos="fade-up"
  >
    <h2>Profile</h2>
    <p>
      Keep track of your adoption journey.
      <br />
      Check the adoption reqests you sent, received and pets you added so far.
    </p>
  </div>
  <!-- End Section Title -->
</section>

<section
  class="w-100 p-4"
  style="background-color: #eee; border-radius: 0.5rem 0.5rem 0 0"
>
  <div class="row">
    <div class="col-lg-4">
      <div class="card mb-4">
        <!-- Loading Spinner -->
        <div *ngIf="loadingProfile" class="text-center p-5">
          <div class="spinner-border text-primary" role="status"></div>
          <p class="mt-3">Loading profile...</p>
        </div>

        <!-- No profile fallback -->
        <div
          *ngIf="!loadingProfile && !profileData"
          class="alert alert-warning text-center"
        >
          Unable to load profile information.
        </div>
        <div class="card-body text-center" *ngIf="!loadingProfile">
          <img
            [src]="
              getFullImageUrl(profileData?.imgUrl || '') ||
              'assets/img/default-user.png'
            "
            alt="avatar"
            class="rounded-circle img-fluid"
            style="width: 150px"
          />
          <h5 class="my-3">
            {{ profileData?.fName }} {{ profileData?.lName }}
          </h5>
          <p class="text-muted mb-1">{{ profileData?.city }}</p>
          <p class="text-muted mb-4">
            <strong>{{ petCount }}</strong> Pets
          </p>
          <div class="d-flex justify-content-center mb-2">
            <button
              type="button"
              class="btn btn-primary"
              routerLink="/profile/update"
            >
              Update Profile
            </button>
            <button
              type="button"
              class="btn btn-outline-primary ms-1"
              routerLink="/add-pet"
            >
              Add Pets
            </button>
          </div>
        </div>
      </div>
      <div class="card mb-4 mt-3">
        <div class="card-body" *ngIf="!loadingProfile">
          <div class="row">
            <div class="col-sm-3">
              <p class="mb-0">Full Name</p>
            </div>
            <div class="col-sm-9">
              <p class="text-muted mb-0">
                {{ profileData?.fName }} {{ profileData?.lName }}
              </p>
            </div>
          </div>
          <hr />
          <div class="row">
            <div class="col-sm-3">
              <p class="mb-0">Email</p>
            </div>
            <div class="col-sm-9">
              <p class="text-muted mb-0">{{ profileData?.email }}</p>
            </div>
          </div>
          <hr />
          <div class="row">
            <div class="col-sm-3">
              <p class="mb-0">Phone</p>
            </div>
            <div class="col-sm-9">
              <p class="text-muted mb-0">{{ profileData?.phoneNumber }}</p>
            </div>
          </div>
          <hr />
          <!-- <div class="row">
            <div class="col-sm-3">
              <p class="mb-0">Mobile</p>
            </div>
            <div class="col-sm-9">
              <p class="text-muted mb-0">(098) 765-4321</p>
            </div>
          </div>
          <hr /> -->
          <div class="row">
            <div class="col-sm-3">
              <p class="mb-0">Address</p>
            </div>
            <div class="col-sm-9">
              <p class="text-muted mb-0">
                {{ profileData?.street }}, {{ profileData?.city }}
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- <div class="card mb-4 mb-lg-0">
        <div class="card-body p-0">
          <ul class="list-group list-group-flush rounded-3">
            <li
              class="list-group-item d-flex justify-content-between align-items-center p-3"
            >
              <i class="fas fa-globe fa-lg text-warning"></i>
              <p class="mb-0">https://mdbootstrap.com</p>
            </li>
            <li
              class="list-group-item d-flex justify-content-between align-items-center p-3"
            >
              <i class="fab fa-github fa-lg text-body"></i>
              <p class="mb-0">mdbootstrap</p>
            </li>
            <li
              class="list-group-item d-flex justify-content-between align-items-center p-3"
            >
              <i class="fab fa-twitter fa-lg" style="color: #55acee"></i>
              <p class="mb-0">@mdbootstrap</p>
            </li>
            <li
              class="list-group-item d-flex justify-content-between align-items-center p-3"
            >
              <i class="fab fa-instagram fa-lg" style="color: #ac2bac"></i>
              <p class="mb-0">mdbootstrap</p>
            </li>
            <li
              class="list-group-item d-flex justify-content-between align-items-center p-3"
            >
              <i class="fab fa-facebook-f fa-lg" style="color: #3b5998"></i>
              <p class="mb-0">mdbootstrap</p>
            </li>
          </ul>
        </div>
      </div> -->
    </div>
    <div class="col-lg-8">
      <div class="row">
        <div class="sent-requests mb-5 mt-3">
          <h5 class="mb-4">Sent Adoption Requests</h5>

          <!-- Loading Spinner -->
          <div *ngIf="loadingReuests" class="text-center p-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-3">Loading adoption requests...</p>
          </div>

          <!-- No Requests -->
          <div
            *ngIf="!loadingReuests && sentRequests.length === 0"
            class="alert alert-info text-center"
          >
            You havenâ€™t sent any adoption requests yet.
          </div>

          <!-- Requests Table-Like Layout -->
          <div class="card shadow-sm" *ngIf="sentRequests.length > 0">
            <div class="card-body p-4">
              <div
                *ngFor="let req of sentRequests"
                class="mb-3 border-bottom pb-3"
              >
                <div class="row align-items-center">
                  <!-- Request text -->
                  <div class="col-md-6">
                    <p class="mb-1">
                      You requested to adopt
                      <strong class="text-dark">{{ req.petName }}</strong>
                    </p>
                  </div>

                  <!-- Status badge -->
                  <div class="col-md-3 text-md-center text-start mt-2 mt-md-0">
                    <span
                      class="badge rounded-pill px-3 py-1"
                      [ngClass]="{
                        'bg-warning text-dark':
                          req.adoptionStatus === 'Pending',
                        'bg-success': req.adoptionStatus === 'Approved',
                        'bg-danger': req.adoptionStatus === 'Cancelled'
                      }"
                      style="font-size: 0.75rem"
                    >
                      {{ req.adoptionStatus }}
                    </span>
                  </div>

                  <!-- Cancel button -->
                  <div class="col-md-3 text-md-end text-start mt-2 mt-md-0">
                    <button
                      *ngIf="
                        requestedPetIds.includes(req.petId) &&
                        req.adoptionStatus === 'Pending'
                      "
                      class="btn btn-danger btn-sm"
                      (click)="cancelAdoptionRequest(req)"
                    >
                      Cancel Request
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="mb-5">
            <h5 class="mb-4">Adoption Requests Received</h5>
            <!-- ðŸ” Filter & Sort Controls -->
            <div class="row mb-3">
              <div class="col-md-6 mb-2">
                <label class="form-label fw-semibold">Filter by Pet:</label>
                <select class="form-select" [(ngModel)]="selectedPetFilter">
                  <option value="">All Pets</option>
                  <option *ngFor="let pet of uniquePetNames" [value]="pet">
                    {{ pet }}
                  </option>
                </select>
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label fw-semibold">Sort by Date:</label>
                <select class="form-select" [(ngModel)]="sortOrder">
                  <option value="desc">Newest First</option>
                  <option value="asc">Oldest First</option>
                </select>
              </div>
            </div>

            <!-- âŒ No Requests -->
            <div
              *ngIf="filteredAndSortedRequests.length === 0"
              class="alert alert-info"
            >
              No adoption requests match your filter.
            </div>

            <!-- âœ… Requests Table -->
            <div
              class="table-responsive"
              *ngIf="filteredAndSortedRequests.length > 0"
            >
              <table class="table table-bordered table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Customer Name</th>
                    <th>Pet Name</th>
                    <th>Date</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let request of filteredAndSortedRequests">
                    <td>{{ request.requesterFullName }}</td>
                    <td>{{ request.petName }}</td>
                    <td>{{ request.adoptionDate | date : "mediumDate" }}</td>
                    <td>
                      <button
                        class="btn btn-outline-success btn-sm"
                        (click)="request.showPhone = !request.showPhone"
                      >
                        <i class="bi bi-whatsapp me-1"></i> Contact
                      </button>
                      <div *ngIf="request.showPhone" class="mt-2">
                        <a
                          [href]="'https://wa.me/2' + request.reqPhoneNumber"
                          target="_blank"
                          class="btn btn-success btn-sm"
                        >
                          ðŸ“ž {{ request.reqPhoneNumber }}
                        </a>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!--0000000000000000000000000000000000000000000000000000000000-->

<!--0000000000000000000000000000000000000000000000000000000000-->
<!--0000000000000000000000000000000000000000000000000000000000-->
<!--0000000000000000000000000000000000000000000000000000000000-->
<!--0000000000000000000000000000000000000000000000000000000000-->
<!--0000000000000000000000000000000000000000000000000000000000-->
<!--0000000000000000000000000000000000000000000000000000000000-->
<div class="container-fluid p-5">
  <div class="row px-5">
    <!-- ðŸ”¸ Right Content (Scrollable Sections) -->
    <div class="col-md-12">
      <!-- My Pets Section -->
      <div class="mb-3 p-3">
        <h3 class="mb-5 text-center fw-bold">My Pets</h3>
        <div class="row justify-content-center team">
          <div
            class="col-md-6 col-lg-3"
            *ngFor="let pet of myPets"
            data-aos="zoom-in"
            data-aos-delay="100"
          >
            <div class="team-card text-center">
              <a [routerLink]="['/pet-details', pet.id]">
                <div class="team-image">
                  <img
                    [src]="getFullImageUrl(pet.imgUrl)"
                    class="img-fluid"
                    [alt]="pet.name"
                  /></div
              ></a>
              <div class="team-content pet-info">
                <h4>{{ pet.name }}</h4>
                <span>Age: {{ pet.age }} years</span>

                <div class="mt-3 d-flex justify-content-center gap-2">
                  <a
                    [routerLink]="['/pet-details', pet.id]"
                    class="btn btn-outline-primary btn-sm"
                    >Learn More</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
